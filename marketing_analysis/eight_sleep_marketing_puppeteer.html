<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eight Sleep Marketing Performance Report (PDF)</title>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@11.4.1/highcharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@11.4.1/modules/funnel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@11.4.1/modules/heatmap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@11.4.1/modules/exporting.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Puppeteer-optimized PDF styling */
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            font-size: 11pt;
            color: #333;
            margin: 0; /* Let Puppeteer handle margins */
            padding: 0;
            line-height: 1.4;
            background-color: #fff;
        }

        /* PDF page setup - let Puppeteer handle headers/footers */
        @page {
            margin: 20mm 18mm 20mm 18mm; /* Even more generous margins to prevent cutoff */
        }

        .container {
            max-width: 100%;
            margin: 0;
            background: white;
            padding: 0;
        }

        h1 {
            font-size: 22pt;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 8px;
            text-align: center;
        }

        .subtitle {
            font-size: 11pt;
            color: #666;
            margin-bottom: 25px;
            text-align: center;
        }

        h2 {
            font-size: 14pt;
            font-weight: 600;
            color: #2C3E50;
            margin-top: 25px;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #ECF0F1;
        }

        h3 {
            font-size: 12pt;
            font-weight: 600;
            color: #34495E;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        /* Page breaks for PDF - optimized for landscape */
        .page-break {
            page-break-before: always;
        }
        
        /* Landscape orientation optimizations */
        @media print {
            body {
                font-size: 10pt;
            }
            .container {
                max-width: 100%;
            }
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 15px;
        }

        /* Executive summary optimized for PDF */
        .executive-summary {
            background: #f8f9fa;
            border: 2px solid #667eea;
            color: #333;
            padding: 18px;
            border-radius: 6px;
            margin-bottom: 25px;
        }

        .executive-summary h2 {
            color: #667eea;
            border: none;
            margin-top: 0;
            margin-bottom: 12px;
            font-size: 15pt;
        }

        /* Metrics grid optimized for PDF */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 15px 0;
        }

        .metric-card {
            background: #fff;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .metric-value {
            font-size: 16pt;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 9pt;
            color: #6c757d;
            font-weight: 500;
        }

        /* Key insights for executive summary */
        .key-insights {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.9);
            border-radius: 4px;
            border-left: 4px solid #667eea;
        }

        .key-insights h3 {
            color: #667eea;
            font-size: 11pt;
            margin-bottom: 8px;
            margin-top: 0;
        }

        .insight-item {
            margin-bottom: 8px;
            font-size: 10pt;
            line-height: 1.3;
        }

        .insight-item strong {
            font-weight: 600;
            color: #2C3E50;
        }

        /* Chart containers optimized for portrait PDF - prevent horizontal cutoff */
        .chart-container {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            padding: 10px 15px; /* Reduced padding for portrait mode */
            margin: 15px 0;
            width: 100%;
            max-width: 100%;
            min-height: 280px; /* Reduced height for portrait stacking */
            max-width: 850px; /* PORTRAIT CONSTRAINT - fit in A4 portrait width */
            page-break-inside: avoid;
            break-inside: avoid;
            height: auto;
            overflow: visible;
            clear: both;
            box-sizing: border-box;
        }

        .chart-title {
            font-size: 12pt;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 12px;
            text-align: center;
            page-break-after: avoid;
            break-after: avoid;
        }

        /* Chart commentary styling */
        .chart-commentary {
            background: #f8fafc;
            border-left: 3px solid #667eea;
            padding: 10px 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            font-size: 9pt;
            color: #4a5568;
            line-height: 1.4;
            clear: both;
        }

        .chart-commentary strong {
            color: #2d3748;
            font-weight: 600;
        }

        /* Ensure all Highcharts containers render properly */
        .highcharts-container {
            width: 100% !important;
            height: 100% !important;
        }

        /* Key findings boxes */
        .finding-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 12px;
            margin: 15px 0;
        }

        .finding-box h4 {
            color: #856404;
            font-size: 11pt;
            margin-bottom: 8px;
        }

        .finding-box p {
            color: #856404;
            font-size: 9pt;
            line-height: 1.3;
            margin-bottom: 6px;
        }

        /* Recommendation sections */
        .recommendation {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
        }

        .recommendation h4 {
            color: #155724;
            font-size: 10pt;
            margin-bottom: 6px;
        }

        .recommendation p {
            color: #155724;
            font-size: 9pt;
            line-height: 1.3;
        }

        /* Priority actions */
        .priority-section {
            background: #e8f4fd;
            border: 1px solid #b0d4f1;
            border-radius: 4px;
            padding: 12px;
            margin: 15px 0;
        }

        .priority-section h4 {
            color: #1e6091;
            font-size: 11pt;
            margin-bottom: 8px;
        }

        .priority-list {
            list-style: none;
            padding: 0;
        }

        .priority-list li {
            margin-bottom: 8px;
            padding-left: 15px;
            font-size: 9pt;
            line-height: 1.3;
            position: relative;
        }

        .priority-list li::before {
            content: "▶";
            position: absolute;
            left: 0;
            color: #1e6091;
            font-weight: bold;
        }

        /* Channel performance table */
        .channel-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 9pt;
        }

        .channel-table th {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px 6px;
            text-align: center;
            font-weight: 600;
            font-size: 9pt;
        }

        .channel-table td {
            border: 1px solid #dee2e6;
            padding: 8px 6px;
            text-align: center;
        }

        .channel-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .channel-name {
            font-weight: 600;
            color: #2C3E50;
        }

        /* Data needs section */
        .data-needs {
            background: #f1f3f4;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }

        .data-needs h3 {
            color: #3c4043;
            margin-bottom: 10px;
        }

        .data-needs ul {
            margin-left: 15px;
            list-style-type: disc;
        }

        .data-needs li {
            margin-bottom: 6px;
            font-size: 9pt;
            line-height: 1.3;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Eight Sleep Marketing Performance Report</h1>
            <p class="subtitle">18-Month Attribution-Aware Analysis | Strategic Intelligence Report</p>
        </div>

        <!-- Executive Summary -->
        <div class="executive-summary">
            <h2>Executive Summary - Attribution-Aware Analysis</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">$14.7M</div>
                    <div class="metric-label">Total Marketing Spend</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">$94.9M</div>
                    <div class="metric-label">Total Revenue</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">6.46x</div>
                    <div class="metric-label">Overall ROAS</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">706,515</div>
                    <div class="metric-label">Email Captures</div>
                </div>
            </div>

            <div class="key-insights">
                <h3>Critical Discoveries</h3>
                <div class="insight-item">
                    <strong>Attribution Discovery:</strong> 0.72 correlation between YouTube spend and Google orders - YouTube drives Google's 4.57x ROAS
                </div>
                <div class="insight-item">
                    <strong>Seasonality Impact:</strong> Q4 revenue 50% above baseline, May spring peak, Q1 suggests budget reallocation opportunities
                </div>
                <div class="insight-item">
                    <strong>Email Quality Gap:</strong> Google leads email conversion at 7.6%, YouTube at 0.97% - optimize highest-performing email funnels first
                </div>
            </div>
        </div>

        <!-- Channel Performance Summary -->
        <div class="section">
            <h2>Channel Performance Overview</h2>
            
            <table class="channel-table">
                <thead>
                    <tr>
                        <th>Channel</th>
                        <th>Spend Share</th>
                        <th>ROAS</th>
                        <th>Orders</th>
                        <th>Avg Order Value</th>
                        <th>Email Captures</th>
                        <th>Email Conv. Rate</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="channel-name">Google Ads</td>
                        <td>69.8%</td>
                        <td>4.57x</td>
                        <td>12,717</td>
                        <td>$3,686</td>
                        <td>147,169</td>
                        <td>7.6%</td>
                    </tr>
                    <tr>
                        <td class="channel-name">YouTube Ads</td>
                        <td>15.4%</td>
                        <td>1.98x</td>
                        <td>934</td>
                        <td>$4,822</td>
                        <td>148,178</td>
                        <td>0.97%</td>
                    </tr>
                    <tr>
                        <td class="channel-name">Facebook Ads</td>
                        <td>14.8%</td>
                        <td>2.98x</td>
                        <td>1,610</td>
                        <td>$4,016</td>
                        <td>119,777</td>
                        <td>0.42%</td>
                    </tr>
                    <tr>
                        <td class="channel-name">Organic + Direct</td>
                        <td>0%</td>
                        <td>∞</td>
                        <td>8,719</td>
                        <td>$4,249</td>
                        <td>291,391</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Channel Performance Trends -->
        <div class="section">
            <h2>Revenue Trends & Channel Performance</h2>
            
            <div class="chart-container">
                <div class="chart-title">Monthly Revenue Trends by Channel (18-Month Period)</div>
                <div id="revenue-trends-chart" style="height: 350px; margin-bottom: 15px;"></div>
                <div class="chart-commentary">
                    <strong>Revenue Growth Analysis:</strong> Google Ads maintains consistent performance with seasonal peaks in May and Q4. YouTube shows dramatic growth in 2025 with April-May surge reaching $1.74M and $0.67M respectively. Facebook Ads demonstrates steady performance with Q4 seasonality peaks.
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Channel Performance Comparison</div>
                <div id="channel-comparison-chart" style="height: 300px; margin-bottom: 15px;"></div>
                <div class="chart-commentary">
                    <strong>Channel Efficiency:</strong> Google Ads leads with 4.57x ROAS despite high spend share (69.8%). Facebook Ads shows strong efficiency at 2.98x ROAS with only 14.8% spend share, indicating potential for scaling. YouTube's 1.98x ROAS includes attribution bias - true performance enhanced by Google cross-channel effects.
                </div>
            </div>
        </div>

        <!-- Page Break -->
        <div class="page-break"></div>

        <!-- Key Findings & Attribution Analysis -->
        <div class="section">
            <h2>Key Findings & Attribution Analysis</h2>
            
            <h3>Email Capture Analysis</h3>
            
            <div class="chart-container">
                <div class="chart-title">Email Capture Rate Comparison by Channel</div>
                <div id="email-capture-comparison" style="height: 300px; margin-bottom: 15px;"></div>
                <div class="chart-commentary">
                    <strong>Email Strategy Optimization:</strong> YouTube captures emails at 2.6% rate vs Facebook's 3.3%, but shows extended conversion patterns suggesting higher-value prospects. Google's superior 7.6% email conversion rate represents proven methodology for optimization across other channels.
                </div>
            </div>
            
            <div class="finding-box">
                <h4>YouTube Attribution Discovery</h4>
                <p>Analysis reveals 0.72 correlation between YouTube spend and Google orders, indicating YouTube's role as an awareness driver that enhances Google's conversion performance.</p>
                <p><strong>Impact:</strong> YouTube's true value extends beyond direct conversions to improving Google's 4.57x ROAS through audience warming and brand awareness.</p>
            </div>

            <div class="chart-container">
                <div class="chart-title">Email Conversion Funnel Analysis</div>
                <div id="funnel-analysis-chart" style="height: 350px; margin-bottom: 15px;"></div>
                <div class="chart-commentary">
                    <strong>Conversion Efficiency:</strong> Total funnel shows 16.96M visitors generating 706K email captures (4.16% rate) and converting to 23,980 orders. Email-to-order conversion rates vary significantly by channel: Google (7.6%), YouTube (0.97%), Facebook (0.42%).
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Email Conversion Patterns: 30-Day vs 60-Day Windows</div>
                <div id="email-analysis-chart" style="height: 300px; margin-bottom: 15px;"></div>
                <div class="chart-commentary">
                    <strong>Email Conversion Quality Analysis:</strong> Google demonstrates superior 7.6% email conversion in 60-day window, nearly 8x higher than YouTube (0.97%) and 18x higher than Facebook (0.42%). This represents a proven methodology for strategic application across channels.
                </div>
            </div>
            
            <div class="finding-box">
                <h4>Strategic Insights</h4>
                <p><strong>Channel Strategy:</strong> YouTube + FB Ads (30.2% of total spend) can be directly scaled. Consider focusing optimization efforts on these channels for maximum impact.</p>
                <p><strong>YouTube Email Opportunity:</strong> Current 2.6% email capture rate with 0.97% email→sale conversion (60-day window). Strong conversion performance suggests quality audience - optimizing capture rate could unlock significant revenue growth.</p>
                <p><strong>FB Ads Underinvested:</strong> Shows true 2.98x ROAS with no attribution bias. Currently only 14.8% of controllable spend despite superior direct response performance.</p>
            </div>
        </div>

        <!-- Strategic Recommendations -->
        <div class="section">
            <h2>Strategic Implementation Plan</h2>
            
            <div class="priority-section">
                <h4>Priority 1: Reverse-Engineer Google's Email Success</h4>
                <ul class="priority-list">
                    <li>Analyze Google's 7.6% email conversion methodology - nurture sequences, timing, messaging, and segmentation</li>
                    <li>Document proven practices from highest-converting email funnel</li>
                    <li>Identify transferable elements for application to other channels</li>
                </ul>
            </div>

            <div class="priority-section">
                <h4>Priority 2: Apply Google's Methods to YouTube</h4>
                <ul class="priority-list">
                    <li>YouTube has quality audience (0.97% conversion) but low capture rate (2.6%)</li>
                    <li>Test Google's nurture strategy with YouTube email audiences</li>
                    <li>Focus on increasing capture rate rather than conversion optimization</li>
                </ul>
            </div>

            <div class="priority-section">
                <h4>Priority 3: Fix Facebook Email Conversion</h4>
                <ul class="priority-list">
                    <li>Facebook's 0.42% email conversion significantly underperforms</li>
                    <li>Test Google's email sequences with Facebook audiences</li>
                    <li>Consider segmentation improvements for direct response audience</li>
                </ul>
            </div>

            <div class="priority-section">
                <h4>Priority 4: Scale Based on Performance</h4>
                <ul class="priority-list">
                    <li>Increase YouTube email capture and Facebook retargeting budgets post-optimization</li>
                    <li>Google is already optimized for revenue extraction at current scale</li>
                    <li>Consider budget reallocation from Q1 to Q4 and May peaks</li>
                </ul>
            </div>
        </div>

        <!-- Page Break -->
        <div class="page-break"></div>

        <!-- Seasonality Analysis -->
        <div class="section">
            <h2>Seasonality Analysis & Revenue Patterns</h2>
            
            <div class="chart-container">
                <div class="chart-title">Revenue Seasonality Heatmap</div>
                <div id="seasonality-heatmap" style="height: 350px; margin-bottom: 15px;"></div>
                <div class="chart-commentary">
                    <strong>Seasonal Optimization:</strong> November-December revenue 50% above average ($7.4M each vs $4.9M baseline). May consistently shows strong performance ($7.7M in 2024, $9.5M in 2025). Q1 represents weakest months suggesting budget reallocation opportunities.
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Conversion Rate Trends: 18-Month Analysis</div>
                <div id="conversion-seasonality" style="height: 300px; margin-bottom: 15px;"></div>
                <div class="chart-commentary">
                    <strong>Channel Evolution:</strong> Google shows improvement in 2025 averaging 17.7% vs 1.3% in 2024. YouTube demonstrates dramatic improvement with conversion rates increasing over 12x from 2024 to 2025, indicating significantly improved targeting and optimization.
                </div>
            </div>
        </div>

        <!-- Data Anomalies Section -->
        <div class="section">
            <h2>Data Anomalies for Investigation</h2>
            
            <div style="background: #FFF3E0; border-left: 4px solid #FF9800; padding: 15px; border-radius: 4px; margin: 15px 0;">
                <h4 style="color: #E65100; font-size: 11pt; margin-bottom: 10px;">Critical Data Quality Issues Requiring Investigation</h4>
                
                <div style="margin-bottom: 10px; font-size: 9pt;">
                    <strong>⚠️ Facebook Conversion Anomaly:</strong> 325% cart-to-order rate detected (143 orders from 44 carts, June 2025) - investigate attribution accuracy
                </div>
                
                <div style="margin-bottom: 10px; font-size: 9pt;">
                    <strong>📉 YouTube Performance Volatility:</strong> 22x variance in monthly performance (Jan-May 2025) suggests tracking changes or external factors
                </div>
                
                <div style="margin-bottom: 10px; font-size: 9pt;">
                    <strong>🔍 Google Ads Traffic Gap:</strong> Despite 69.8% spend share, absent from top visitor months - verify traffic attribution methodology
                </div>
                
                <div style="margin-bottom: 10px; font-size: 9pt;">
                    <strong>📧 Organic Email Conversion Gap:</strong> 291K email captures but 0 tracked email conversions - investigate attribution window settings
                </div>
                
                <div style="margin-bottom: 10px; font-size: 9pt;">
                    <strong>💰 AOV Channel Variance:</strong> 31% difference in average order value by channel ($3,686-$4,822) - analyze customer segmentation
                </div>
                
                <div style="margin-bottom: 10px; font-size: 9pt;">
                    <strong>📊 Email Capture Rate Inconsistency:</strong> 2x variance between channels (2.6%-5.2%) - standardize measurement methodology
                </div>
                
                <div style="margin-bottom: 10px; font-size: 9pt;">
                    <strong>🚨 Q2 2025 Tracking Changes:</strong> Multiple conversion anomalies suggest measurement methodology updates requiring validation
                </div>
            </div>
        </div>
        
        <!-- Data Needs & Future Analysis -->
        <div class="section">
            <h2>Priority Data Needs</h2>
            
            <div class="data-needs">
                <h3>Recommended Analysis Extensions</h3>
                <ul>
                    <li><strong>Google Ads Breakdown:</strong> Understand spend allocation across Display, Branded Search, and Non-Branded Search campaigns to optimize channel mix</li>
                    <li><strong>Lift Studies:</strong> Consider implementing incrementality testing to measure true channel contribution beyond last-click attribution</li>
                    <li><strong>Marketing Mix Modeling (MMM):</strong> Explore deploying statistical models to understand cross-channel interactions and optimal budget allocation</li>
                    <li><strong>Post-Purchase Surveys:</strong> Consider collecting first-party data on customer journey and channel influence to validate attribution models</li>
                    <li><strong>Multi-touch Attribution:</strong> Quantify YouTube's contribution to Google conversions and cross-channel assist rates</li>
                    <li><strong>Customer Lifetime Value:</strong> Consider optimizing CAC thresholds by channel quality and customer cohort performance</li>
                </ul>
            </div>
        </div>

        <!-- Business Implications -->
        <div class="section">
            <h2>Business Implications Summary</h2>
            
            <div class="recommendation">
                <h4>YouTube: The Awareness Engine</h4>
                <p><strong>Strategic Role:</strong> Drive awareness and email capture, not direct conversions. Current 2.6% email capture rate with strong 0.97% email-to-sale conversion indicates high-quality audience fit and potential to focus on increasing capture rate rather than conversion optimization.</p>
            </div>

            <div class="recommendation">
                <h4>Google: The Email Conversion Champion</h4>
                <p><strong>Hidden Strength:</strong> 7.6% email-to-sale conversion rate (60-day window) - nearly 8x higher than YouTube and 18x higher than Facebook. Consider scaling Google's email capture and nurture processes and applying methodology to other channels.</p>
            </div>

            <div class="recommendation">
                <h4>Facebook Ads: The Conversion Engine</h4>
                <p><strong>Strategic Role:</strong> Convert aware prospects through direct response and retargeting. True 2.98x ROAS with no attribution bias. Underinvested at 14.8% of controllable spend, but email conversion (0.42%) lags significantly.</p>
            </div>

            <div class="recommendation">
                <h4>Cross-Channel Email Strategy</h4>
                <p><strong>The Connecting Thread:</strong> YouTube captures emails (2.6% rate) → Google's superior nurture (7.6% conversion) → FB retargeting converts → Organic harvests branded search. Google's superior email conversion represents proven methodology for strategic application.</p>
            </div>
        </div>
    </div>

    <script>
        // Marketing data embedded directly for PDF generation reliability
        const marketingData = {
            "channelSummary": {
                "googleAds": {
                    "spend": 10256461,
                    "revenue": 46864519,
                    "orders": 12717,
                    "visitors": 1938001,
                    "emailCaptures": 147169,
                    "emailConversions30Day": 7896,
                    "emailConversions60Day": 11219
                },
                "youtubeAds": {
                    "spend": 2269742,
                    "revenue": 4503624,
                    "orders": 934,
                    "visitors": 5741010,
                    "emailCaptures": 148178,
                    "emailConversions30Day": 1029,
                    "emailConversions60Day": 1439
                },
                "fbAds": {
                    "spend": 2167849,
                    "revenue": 6464098,
                    "orders": 1610,
                    "visitors": 3675412,
                    "emailCaptures": 119777,
                    "emailConversions30Day": 359,
                    "emailConversions60Day": 503
                },
                "organicDirect": {
                    "spend": 0,
                    "revenue": 37029412,
                    "orders": 8719,
                    "visitors": 5604223,
                    "emailCaptures": 291391,
                    "emailConversions30Day": 0,
                    "emailConversions60Day": 0
                }
            },
            "totalMetrics": {
                "averageOrderValue": 3955
            }
        };

        // Color palette
        const colors = {
            primary: '#3498DB',
            secondary: '#E74C3C', 
            success: '#27AE60',
            warning: '#F39C12',
            muted: '#95A5A6',
            dark: '#2C3E50'
        };

        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Creating charts for PDF generation...');
            createAllCharts();
        });

        function createAllCharts() {
            createRevenueTrendsChart();
            createChannelComparisonChart();
            createFunnelChart();
            createEmailCaptureChart();
            createEmailAnalysisChart();
            createSeasonalityHeatmap();
            createConversionSeasonality();
        }

        // Revenue Trends Chart with accurate data and better legend positioning
        function createRevenueTrendsChart() {
            Highcharts.chart('revenue-trends-chart', {
                chart: { 
                    type: 'line', 
                    height: 300, 
                    backgroundColor: '#ffffff',
                    spacingTop: 10,
                    spacingBottom: 40, 
                    spacingLeft: 60, // Reduced spacing for portrait
                    spacingRight: 60 // Reduced spacing for portrait
                },
                title: { text: null },
                xAxis: {
                    categories: ['Jan 24', 'Feb 24', 'Mar 24', 'Apr 24', 'May 24', 'Jun 24', 
                               'Jul 24', 'Aug 24', 'Sep 24', 'Oct 24', 'Nov 24', 'Dec 24',
                               'Jan 25', 'Feb 25', 'Mar 25', 'Apr 25', 'May 25', 'Jun 25'],
                    labels: { 
                        rotation: -45, 
                        style: { fontSize: '8px' },
                        step: 1 // Show all labels
                    },
                    plotLines: [{
                        color: '#ccc',
                        width: 1,
                        value: 11.5,
                        dashStyle: 'shortdash',
                        zIndex: 3,
                        label: {
                            text: '2024 | 2025',
                            style: { fontSize: '8px', color: '#666' },
                            align: 'center'
                        }
                    }]
                },
                yAxis: {
                    title: { text: 'Revenue ($M)', style: { fontSize: '10px' } },
                    labels: {
                        formatter: function() {
                            return '$' + this.value.toFixed(1) + 'M';
                        },
                        style: { fontSize: '9px' }
                    }
                },
                tooltip: {
                    shared: true,
                    valuePrefix: '$',
                    valueSuffix: 'M',
                    valueDecimals: 2
                },
                series: [{
                    name: 'Google', // SHORTENED to prevent cutoff
                    data: [1.28, 1.31, 1.97, 2.17, 4.42, 3.37, 3.16, 2.53, 2.35, 1.83, 3.30, 3.41, 2.25, 2.38, 1.87, 2.23, 3.93, 3.10],
                    color: colors.primary,
                    lineWidth: 2,
                    marker: { radius: 3 }
                }, {
                    name: 'YouTube', // SHORTENED to prevent cutoff
                    data: [0.003, 0.03, 0.01, 0.04, 0.09, 0.06, 0.09, 0.38, 0.11, 0.07, 0.15, 0.11, 0.08, 0.07, 0.24, 0.56, 1.74, 0.67],
                    color: colors.warning,
                    lineWidth: 2,
                    marker: { radius: 3 }
                }, {
                    name: 'Facebook', // SHORTENED to prevent cutoff
                    data: [0.08, 0.14, 0.25, 0.25, 0.57, 0.30, 0.20, 0.23, 0.27, 0.19, 0.64, 0.47, 0.27, 0.26, 0.45, 0.31, 0.90, 0.70],
                    color: colors.secondary,
                    lineWidth: 2,
                    marker: { radius: 3 }
                }, {
                    name: 'Organic',
                    data: [1.04, 0.99, 1.01, 1.26, 2.66, 1.82, 1.85, 2.20, 1.99, 1.87, 3.32, 3.36, 2.00, 2.02, 1.96, 1.83, 2.95, 2.91],
                    color: colors.success,
                    lineWidth: 2,
                    dashStyle: 'shortdot',
                    marker: { radius: 3 }
                }],
                legend: { 
                    itemStyle: { fontSize: '9px' },
                    align: 'center',
                    verticalAlign: 'bottom',
                    y: -5,
                    symbolWidth: 16,
                    maxHeight: 50,
                    itemWidth: 70, // Reduced for portrait
                    itemMarginTop: 2,
                    useHTML: false // Prevent HTML rendering issues
                },
                credits: { enabled: false }
            });
        }

        // Channel Comparison Chart with better spacing and ROAS display
        function createChannelComparisonChart() {
            Highcharts.chart('channel-comparison-chart', {
                chart: { 
                    type: 'column', 
                    height: 280, 
                    backgroundColor: '#ffffff',
                    spacingTop: 15,
                    spacingBottom: 35,
                    spacingLeft: 40, // Reduced spacing for portrait
                    spacingRight: 40 // Reduced spacing for portrait
                },
                title: { text: null },
                xAxis: {
                    categories: ['Google Ads', 'YouTube Ads', 'Facebook Ads', 'Organic + Direct'],
                    labels: { 
                        style: { fontSize: '9px' },
                        overflow: 'justify'
                    }
                },
                yAxis: [{
                    title: { text: 'ROAS', style: { color: colors.primary, fontSize: '10px' } },
                    labels: { 
                        style: { color: colors.primary, fontSize: '9px' },
                        formatter: function() { return this.value + 'x'; }
                    }
                }, {
                    title: { text: 'Conversion Rate (%)', style: { color: colors.success, fontSize: '10px' } },
                    labels: { 
                        style: { color: colors.success, fontSize: '9px' },
                        formatter: function() { return this.value + '%'; }
                    },
                    opposite: true
                }],
                tooltip: { shared: true },
                series: [{
                    name: 'ROAS',
                    data: [4.57, 1.98, 2.98, null],
                    color: colors.primary,
                    yAxis: 0,
                    dataLabels: {
                        enabled: true,
                        format: '{point.y}x',
                        style: { fontSize: '10px', fontWeight: 'bold', color: '#2C3E50' },
                        allowOverlap: false,
                        padding: 10, // More padding to prevent overlap
                        crop: false,
                        overflow: 'justify', // Better text positioning
                        useHTML: false, // Ensure clean text rendering
                        verticalAlign: 'bottom',
                        y: -8 // Position above bars with better spacing
                    }
                }, {
                    name: 'Conversion Rate',
                    type: 'line',
                    data: [0.66, 0.02, 0.08, 0.16],
                    color: colors.success,
                    yAxis: 1,
                    marker: { radius: 4 },
                    lineWidth: 2
                }],
                legend: { 
                    itemStyle: { fontSize: '9px' },
                    align: 'center',
                    verticalAlign: 'bottom',
                    y: -5,
                    maxHeight: 35,
                    itemWidth: 70, // Optimized for portrait
                    useHTML: false
                },
                credits: { enabled: false }
            });
        }

        // Funnel Analysis Chart with better spacing
        function createFunnelChart() {
            Highcharts.chart('funnel-analysis-chart', {
                chart: { 
                    type: 'funnel', 
                    height: 350, 
                    backgroundColor: '#ffffff',
                    spacingTop: 15,
                    spacingBottom: 15,
                    spacingLeft: 40, // Increased spacing for better fit
                    spacingRight: 40 // Increased spacing for better fit
                },
                title: { text: null },
                plotOptions: {
                    series: {
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b><br>({point.y:,.0f})',
                            style: { fontSize: '9px', fontWeight: 'bold' },
                            softConnector: true
                        },
                        center: ['50%', '50%'],
                        neckWidth: '30%',
                        neckHeight: '25%',
                        width: '75%' // Slightly narrower to prevent cutoff
                    }
                },
                series: [{
                    name: 'Conversion Funnel',
                    data: [
                        ['Total Visitors', 16958646],
                        ['Email Captures', 706515],
                        ['Add to Cart', 119899],
                        ['Orders Placed', 23980]
                    ],
                    colors: [colors.muted, colors.primary, colors.warning, colors.success]
                }],
                credits: { enabled: false }
            });
        }

        // Email Capture Rate Comparison Chart
        function createEmailCaptureChart() {
            // Calculate capture rates
            const youtubeData = {
                captures: marketingData.channelSummary.youtubeAds.emailCaptures,
                visitors: marketingData.channelSummary.youtubeAds.visitors
            };
            const facebookData = {
                captures: marketingData.channelSummary.fbAds.emailCaptures,
                visitors: marketingData.channelSummary.fbAds.visitors
            };
            const googleData = {
                captures: marketingData.channelSummary.googleAds.emailCaptures,
                visitors: marketingData.channelSummary.googleAds.visitors
            };
            const organicData = {
                captures: marketingData.channelSummary.organicDirect.emailCaptures,
                visitors: marketingData.channelSummary.organicDirect.visitors
            };
            
            const youtubeCaptureRate = (youtubeData.captures / youtubeData.visitors * 100);
            const facebookCaptureRate = (facebookData.captures / facebookData.visitors * 100);
            const googleCaptureRate = (googleData.captures / googleData.visitors * 100);
            const organicCaptureRate = (organicData.captures / organicData.visitors * 100);

            Highcharts.chart('email-capture-comparison', {
                chart: { 
                    type: 'column', 
                    height: 280, 
                    backgroundColor: '#ffffff',
                    spacingTop: 15,
                    spacingBottom: 35,
                    spacingLeft: 60,
                    spacingRight: 60
                },
                title: { text: null },
                xAxis: {
                    categories: ['YouTube Ads', 'Facebook Ads', 'Google Ads', 'Organic/Direct'],
                    labels: { style: { fontSize: '9px' } }
                },
                yAxis: {
                    title: { text: 'Email Capture Rate (%)', style: { fontSize: '10px' } },
                    labels: {
                        formatter: function() { return this.value + '%'; },
                        style: { fontSize: '9px' }
                    }
                },
                tooltip: {
                    formatter: function() {
                        return '<b>' + this.y.toFixed(1) + '%</b> capture rate<br/>' +
                               '<span style="color:#666;">' + 
                               (this.x === 0 ? '148K emails from 5.7M visitors' :
                                this.x === 1 ? '120K emails from 3.7M visitors' :
                                this.x === 2 ? '147K emails from 1.9M visitors' :
                                '291K emails from 5.6M visitors') + '</span>';
                    }
                },
                plotOptions: {
                    column: { 
                        borderWidth: 0,
                        dataLabels: {
                            enabled: true,
                            formatter: function() {
                                return this.y.toFixed(1) + '%';
                            },
                            style: { fontSize: '9px', fontWeight: 'bold' }
                        }
                    }
                },
                series: [{
                    name: 'Email Capture Rate',
                    data: [
                        { y: youtubeCaptureRate, color: colors.warning },
                        { y: facebookCaptureRate, color: colors.secondary },
                        { y: googleCaptureRate, color: colors.primary },
                        { y: organicCaptureRate, color: colors.success }
                    ],
                    showInLegend: false
                }],
                credits: { enabled: false }
            });
        }
        
        // Email Analysis Chart with better spacing and full legend names
        function createEmailAnalysisChart() {
            Highcharts.chart('email-analysis-chart', {
                chart: { 
                    type: 'bar', 
                    height: 280, 
                    backgroundColor: '#ffffff',
                    spacingTop: 10,
                    spacingBottom: 35,
                    spacingLeft: 80, // Reduced spacing for portrait
                    spacingRight: 50 // Reduced spacing for portrait
                },
                title: { text: null },
                xAxis: {
                    categories: ['YouTube Ads', 'Facebook Ads', 'Google Ads'],
                    labels: { style: { fontSize: '10px' } }
                },
                yAxis: {
                    title: { text: 'Email-to-Sale Conversion Rate (%)', style: { fontSize: '10px' } },
                    labels: {
                        formatter: function() { return this.value + '%'; },
                        style: { fontSize: '8px' }
                    },
                    max: 8.0, // Optimized to properly show 7.6% with padding
                    tickInterval: 2
                },
                tooltip: { valueSuffix: '% conversion rate' },
                plotOptions: {
                    series: {
                        dataLabels: {
                            enabled: true,
                            format: '{y:.2f}%',
                            style: { fontSize: '9px', fontWeight: 'bold' }
                        }
                    }
                },
                series: [{
                    name: '30-Day Email Conversion',
                    data: [0.69, 0.30, 5.37],
                    color: 'rgba(52, 152, 219, 0.7)'
                }, {
                    name: '60-Day Email Conversion',
                    data: [0.97, 0.42, 7.60], // FIXED: was 7.62, now correct 7.6%
                    color: 'rgba(52, 152, 219, 1.0)'
                }],
                legend: { 
                    itemStyle: { fontSize: '9px' },
                    align: 'center',
                    verticalAlign: 'bottom',
                    y: -5,
                    symbolWidth: 16,
                    maxHeight: 50,
                    itemWidth: 100, // Reduced for portrait
                    useHTML: false
                },
                credits: { enabled: false }
            });
        }

        // Seasonality Heatmap with better spacing
        function createSeasonalityHeatmap() {
            Highcharts.chart('seasonality-heatmap', {
                chart: { 
                    type: 'heatmap', 
                    height: 320, 
                    backgroundColor: '#ffffff',
                    spacingTop: 10,
                    spacingBottom: 15,
                    spacingLeft: 40, // Reduced for portrait
                    spacingRight: 80 // Reduced for portrait
                },
                title: { text: null },
                xAxis: {
                    categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    labels: { style: { fontSize: '9px' } }
                },
                yAxis: {
                    categories: ['2024', '2025'],
                    title: null,
                    labels: { style: { fontSize: '10px' } }
                },
                colorAxis: {
                    min: 0,
                    max: 10,
                    stops: [
                        [0, '#ffffff'],
                        [0.3, '#fef0d9'],
                        [0.5, '#fdcc8a'],
                        [0.7, '#fc8d59'],
                        [1, '#d7301f']
                    ],
                    labels: {
                        formatter: function() { return '$' + this.value + 'M'; },
                        style: { fontSize: '9px' }
                    }
                },
                legend: {
                    align: 'right',
                    layout: 'vertical',
                    margin: 0,
                    verticalAlign: 'middle',
                    y: 25,
                    symbolHeight: 140,
                    width: 60
                },
                tooltip: {
                    formatter: function() {
                        return this.series.xAxis.categories[this.point.x] + ' ' +
                               this.series.yAxis.categories[this.point.y] + ': <b>$' +
                               this.point.value.toFixed(2) + 'M</b> revenue';
                    }
                },
                series: [{
                    name: 'Revenue',
                    borderWidth: 1,
                    borderColor: '#e0e0e0',
                    data: [
                        // 2024
                        [0, 0, 2.4], [1, 0, 2.5], [2, 0, 3.2], [3, 0, 3.7], [4, 0, 7.7], [5, 0, 5.5],
                        [6, 0, 5.3], [7, 0, 5.3], [8, 0, 4.7], [9, 0, 4.0], [10, 0, 7.4], [11, 0, 7.4],
                        // 2025 (partial)
                        [0, 1, 4.6], [1, 1, 4.7], [2, 1, 4.5], [3, 1, 4.9], [4, 1, 9.5], [5, 1, 7.4]
                    ],
                    dataLabels: {
                        enabled: true,
                        format: '{point.value:.1f}M',
                        style: { color: '#000000', fontSize: '8px', fontWeight: 'bold' }
                    }
                }],
                credits: { enabled: false }
            });
        }

        // Conversion Rate Seasonality with better spacing
        function createConversionSeasonality() {
            Highcharts.chart('conversion-seasonality', {
                chart: { 
                    type: 'area', 
                    height: 280, 
                    backgroundColor: '#ffffff',
                    spacingTop: 10,
                    spacingBottom: 45, // Space for rotated labels
                    spacingLeft: 60, // Reduced spacing for portrait
                    spacingRight: 60 // Reduced spacing for portrait
                },
                title: { text: null },
                xAxis: {
                    categories: ['Jan 24', 'Feb 24', 'Mar 24', 'Apr 24', 'May 24', 'Jun 24', 'Jul 24', 'Aug 24', 'Sep 24', 'Oct 24', 'Nov 24', 'Dec 24', 'Jan 25', 'Feb 25', 'Mar 25', 'Apr 25', 'May 25', 'Jun 25'],
                    labels: { 
                        rotation: -45, 
                        style: { fontSize: '7px' },
                        step: 1 // Show all labels
                    },
                    plotLines: [{
                        color: '#ccc',
                        width: 1,
                        value: 11.5,
                        dashStyle: 'shortdash',
                        zIndex: 3,
                        label: {
                            text: '2024 | 2025',
                            style: { fontSize: '8px', color: '#666' },
                            align: 'center'
                        }
                    }]
                },
                yAxis: {
                    title: { text: 'Conversion Rate (%)', style: { fontSize: '10px' } },
                    labels: {
                        formatter: function() { return this.value + '%'; },
                        style: { fontSize: '9px' }
                    }
                },
                tooltip: {
                    valueSuffix: '%',
                    valueDecimals: 3,
                    shared: true
                },
                plotOptions: {
                    area: {
                        stacking: null,
                        lineColor: '#666666',
                        lineWidth: 1,
                        fillOpacity: 0.3,
                        marker: { radius: 2 }
                    }
                },
                series: [{
                    name: 'Google', // SHORTENED to prevent legend cutoff
                    data: [0.458, 0.709, 0.832, 1.060, 0.802, 0.780, 0.642, 0.675, 0.784, 0.859, 0.835, 1.050, 0.526, 0.657, 0.524, 0.563, 0.397, 0.417],
                    color: colors.primary
                }, {
                    name: 'Facebook', // SHORTENED to prevent legend cutoff
                    data: [0.033, 0.039, 0.052, 0.047, 0.063, 0.101, 0.072, 0.025, 0.073, 0.063, 0.123, 0.129, 0.049, 0.033, 0.026, 0.030, 0.038, 0.023],
                    color: colors.secondary
                }, {
                    name: 'YouTube', // SHORTENED to prevent legend cutoff
                    data: [0.003, 0.028, 0.009, 0.017, 0.010, 0.015, 0.012, 0.021, 0.014, 0.013, 0.006, 0.007, 0.006, 0.007, 0.019, 0.019, 0.025, 0.024],
                    color: colors.warning
                }],
                legend: { 
                    itemStyle: { fontSize: '9px' },
                    align: 'center',
                    verticalAlign: 'bottom',
                    y: -5,
                    symbolWidth: 16,
                    maxHeight: 50,
                    itemWidth: 80, // Reduced for portrait
                    useHTML: false
                },
                credits: { enabled: false }
            });
        }
    </script>
</body>
</html>